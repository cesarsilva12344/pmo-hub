<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PMO Hub | Acesso</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>body { font-family: 'Inter', sans-serif; background-color: #0f172a; }</style>
</head>
<body class="h-screen flex items-center justify-center relative overflow-hidden">

    <div class="absolute top-0 left-0 w-full h-full opacity-10 pointer-events-none">
        <div class="absolute top-10 left-10 w-64 h-64 bg-blue-500 rounded-full blur-3xl"></div>
        <div class="absolute bottom-10 right-10 w-96 h-96 bg-indigo-600 rounded-full blur-3xl"></div>
    </div>

    <div class="bg-white w-96 rounded-2xl shadow-2xl p-8 z-10">
        <div class="text-center mb-8">
            <div class="w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center text-white text-xl font-bold mx-auto mb-3 shadow-lg shadow-blue-500/30"><i class="fas fa-layer-group"></i></div>
            <h1 class="text-2xl font-bold text-slate-800 tracking-tight">PMO<span class="text-blue-600">Hub</span></h1>
            <p class="text-xs text-slate-400 uppercase tracking-widest font-semibold mt-1">Gestão Estratégica v14.4</p>
        </div>

        <div class="flex border-b border-slate-100 mb-6">
            <button onclick="toggleTab('login')" id="tab-login" class="flex-1 pb-2 text-sm font-bold text-blue-600 border-b-2 border-blue-600 transition">Entrar</button>
            <button onclick="toggleTab('signup')" id="tab-signup" class="flex-1 pb-2 text-sm font-bold text-slate-400 hover:text-slate-600 transition">Criar Conta</button>
        </div>

        <div class="space-y-4">
            <div>
                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">E-mail</label>
                <div class="relative">
                    <i class="fas fa-envelope absolute left-3 top-3 text-slate-400 text-sm"></i>
                    <input type="email" id="email" class="w-full border border-slate-300 rounded-lg py-2.5 pl-10 text-sm focus:ring-2 focus:ring-blue-500 outline-none" placeholder="seu@email.com">
                </div>
            </div>
            
            <div id="field-pass">
                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Senha</label>
                <div class="relative">
                    <i class="fas fa-lock absolute left-3 top-3 text-slate-400 text-sm"></i>
                    <input type="password" id="password" class="w-full border border-slate-300 rounded-lg py-2.5 pl-10 text-sm focus:ring-2 focus:ring-blue-500 outline-none" placeholder="••••••••">
                </div>
            </div>

            <button onclick="handleAuth()" id="btn-action" class="w-full bg-slate-900 hover:bg-slate-800 text-white font-bold py-2.5 rounded-lg transition shadow-lg mt-2">Acessar Sistema</button>
            
            <div id="link-reset" class="text-center mt-4">
                <button onclick="toggleTab('reset')" class="text-xs text-slate-400 hover:text-blue-600 font-medium">Esqueci minha senha</button>
            </div>
            
            <div id="link-back" class="text-center mt-4 hidden">
                <button onclick="toggleTab('login')" class="text-xs text-slate-400 hover:text-blue-600 font-medium">Voltar para Login</button>
            </div>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script>
        let currentMode = 'login'; // login, signup, reset

        // Verifica se já está logado ao abrir
        window.onload = async () => {
            const { data } = await window.supabaseClient.auth.getSession();
            if (data && data.session) window.location.href = 'index.html';
        };

        function toggleTab(mode) {
            currentMode = mode;
            const btn = document.getElementById('btn-action');
            const fieldPass = document.getElementById('field-pass');
            const linkReset = document.getElementById('link-reset');
            const linkBack = document.getElementById('link-back');
            const tabLogin = document.getElementById('tab-login');
            const tabSignup = document.getElementById('tab-signup');

            // Reset estilos
            tabLogin.className = "flex-1 pb-2 text-sm font-bold text-slate-400 border-b-2 border-transparent transition";
            tabSignup.className = "flex-1 pb-2 text-sm font-bold text-slate-400 border-b-2 border-transparent transition";

            if (mode === 'login') {
                btn.innerText = "Acessar Sistema";
                fieldPass.classList.remove('hidden');
                linkReset.classList.remove('hidden');
                linkBack.classList.add('hidden');
                tabLogin.className = "flex-1 pb-2 text-sm font-bold text-blue-600 border-b-2 border-blue-600 transition";
            } else if (mode === 'signup') {
                btn.innerText = "Criar Conta Grátis";
                fieldPass.classList.remove('hidden');
                linkReset.classList.add('hidden');
                linkBack.classList.add('hidden');
                tabSignup.className = "flex-1 pb-2 text-sm font-bold text-blue-600 border-b-2 border-blue-600 transition";
            } else if (mode === 'reset') {
                btn.innerText = "Enviar Link de Recuperação";
                fieldPass.classList.add('hidden');
                linkReset.classList.add('hidden');
                linkBack.classList.remove('hidden');
            }
        }

        async function handleAuth() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const btn = document.getElementById('btn-action');

            if (!email) return alert("Digite seu e-mail.");
            
            btn.disabled = true;
            btn.innerText = "Processando...";

            try {
                if (currentMode === 'login') {
                    await window.Auth.signIn(email, password);
                    window.location.href = 'index.html';
                } 
                else if (currentMode === 'signup') {
                    if (!password) throw new Error("Crie uma senha.");
                    await window.Auth.signUp(email, password);
                    alert("Conta criada com sucesso! Você já está logado.");
                    window.location.href = 'index.html';
                } 
                else if (currentMode === 'reset') {
                    await window.Auth.resetPassword(email);
                    alert("E-mail de recuperação enviado! Verifique sua caixa de entrada.");
                    toggleTab('login');
                }
            } catch (err) {
                console.error(err);
                alert("Erro: " + (err.message || "Falha na autenticação. Verifique os dados."));
            } finally {
                btn.disabled = false;
                if(currentMode === 'login') btn.innerText = "Acessar Sistema";
                if(currentMode === 'signup') btn.innerText = "Criar Conta Grátis";
                if(currentMode === 'reset') btn.innerText = "Enviar Link de Recuperação";
            }
        }
    </script>
</body>
</html>